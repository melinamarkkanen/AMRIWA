colnames(heat.df) <- c(
"BFH16_S134" = 	"Pediatric hospitalization",
"BFH17_S135" = 	"Medicine hospitalization",
"BFH18_S136" = 	"Delivery room",
"BFH19_S137" =	"Gynecology, operating room",
"BFH20_S138" = 	"Maternity hospitalization",
"BFH21_S139" =	"Surgery emergency, hospitalization",
"BFH22_S140" =	"Laboratory",
"BFH23_S141" =	"Emergency, external consultation",
"BFH25_S143" = 	"Big well",
"BFH26_S144" = 	"Exit after treatment \n(municipality channel)",
"BFH27_S145" =	"Marigot river",
"BFH28_S146" =  "Pediatric emergency",
"BFH1_S123" = "Big well no. 1",
"BFH4_S124" = "Pediatrics")
# So same to the tax_table
# Extract abundance matrix from the phyloseq object
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 20, cellheight = 10, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 5, fontsize_col = 6,
labels_row = as.expression(newnames), gaps_col = 12,
filename = "OtherBF_heat.png")
custom_heat
samples_to_keep <- c("BFH6_S125",	"BFH8_S126",	"BFH9_S127",	"BFH10_S128",	"BFH11_S129",	"BFH12_S130",	"BFH13_S131",	"BFH14_S132",	"BFH15_S133")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
rfc <- plot_bar(rfc0, fill = "Class")
rfc_plot <- rfc +
geom_bar(stat="identity", color = NA, size = 0) +
scale_y_continuous(labels = waiver(), limits=c(0,1.35)) +
scale_fill_manual(values = rfc_cols) +
labs(y = expression(atop(bold("ARG Abundance by Antibiotic Classes"), atop("ARGs / 16S rRNA")))) +
theme_minimal() +
theme(axis.text.x = element_text(size = 14, family = "Times", angle = 90),
axis.text.y = element_text(size = 28, family = "Times", face = "bold", angle = 90),
axis.title.y = element_text(size = 30, family = "Times"),
legend.text = element_text(size = 18, family = "Times"),
legend.title = element_blank(),
legend.key = element_rect(size = 2, color = "white"),
legend.key.size = unit(1, "cm"),
legend.spacing.y = unit(2.2, "char"),
panel.background = element_rect(fill = "#FFFCF3"),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank()) +
facet_grid(~location, scales = "free", space = "free", labeller = label_wrap_gen(width = 15, multi_line = TRUE)) +
theme(strip.text.x= element_text(angle = 90, size = 30, family = "Times", hjust = 0, vjust = 0.75),
strip.background = element_rect(colour = "white"))
## Save plot
ggsave(filename = "Ougadougou_rfc.png",
width = 16, height = 13, dpi = 300, units = "in", device='png', scale = 1)
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
# reorder
col_order <- c("BFH10_S128", "BFH11_S129", "BFH12_S130", "BFH6_S125","BFH8_S126", "BFH9_S127", "BFH13_S131", "BFH14_S132", "BFH15_S133")
heat.df <- heat.df[, col_order]
#rename cols
colnames(heat.df) <- c("BFH10_S128" = "Delivery room, surgery",
"BFH11_S129" =	"Laboratory",
"BFH12_S130" =	"Pediatrics",
"BFH6_S125" = "Hospitalization, \nmaternity, surgery",
"BFH8_S126" = "Surgery",
"BFH9_S127" =	"Mortuary",
"BFH13_S131" =	"Delivery room",
"BFH14_S132" =	"Hospitalization, \nmaternity",
"BFH15_S133" =	"Hospitalization, \nmaternity, surgery")
# So same to the tax_table
# Extract abundance matrix from the phyloseq object
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 20, cellheight = 10, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 5, fontsize_col = 6,
labels_row = as.expression(newnames), gaps_col = 6,
filename = "Ougadougou_heat.png")
custom_heat
samples_to_keep <- c("BFH29_S147",	"BFH30_S148",	"BFH31_S149",	"BFH32_S150",	"BFH33_S151",	"BFH34_S152",	"BFH35_S153",	"BFH36_S154",	"BFH37_S155",	"BFH38.A_S156",	"BFH38.B_S157",	"BFH39_S158",	"BFH40_S159",	"BFH41_S160",	"BFH42_S161")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
rfc <- plot_bar(rfc0, fill = "Class")
rfc_plot <- rfc +
geom_bar(stat="identity", color = NA, size = 0) +
scale_y_continuous(labels = waiver(), limits=c(0,1.35)) +
scale_fill_manual(values = rfc_cols) +
labs(y = expression(atop(bold("ARG Abundance by Antibiotic Classes"), atop("ARGs / 16S rRNA")))) +
theme_minimal() +
theme(axis.text.x = element_text(size = 14, family = "Times", angle = 90),
axis.text.y = element_text(size = 28, family = "Times", face = "bold", angle = 90),
axis.title.y = element_text(size = 30, family = "Times"),
legend.text = element_text(size = 18, family = "Times"),
legend.title = element_blank(),
legend.key = element_rect(size = 2, color = "white"),
legend.key.size = unit(1, "cm"),
legend.spacing.y = unit(2.2, "char"),
panel.background = element_rect(fill = "#FFFCF3"),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank()) +
facet_grid(~location, scales = "free", space = "free", labeller = label_wrap_gen(width = 15, multi_line = TRUE)) +
theme(strip.text.x= element_text(angle = 90, size = 30, family = "Times", hjust = 0, vjust = 0.75),
strip.background = element_rect(colour = "white"))
## Save plot
ggsave(filename = "Yalgado_rfc.png",
width = 16, height = 13, dpi = 300, units = "in", device='png', scale = 1)
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
# reorder
col_order <- c("BFH29_S147", "BFH30_S148", "BFH32_S150", "BFH33_S151", "BFH34_S152", "BFH35_S153", "BFH36_S154", "BFH37_S155", "BFH38.A_S156", "BFH38.B_S157", "BFH39_S158", "BFH40_S159", "BFH40_S159", "BFH41_S160", "BFH42_S161")
heat.df <- heat.df[, col_order]
# rename cols
colnames(heat.df) <- c("BFH29_S147" = "Urology, infectious diseases, pneumology",
"BFH30_S148" = "Urology, infectious diseases, \npneumology, daily hospital, \ndialysis, blood bank",
"BFH31_S149" = "Anatomy pathology laboratory, \nophtalmology, laboratory of \nhematology-biochemestry, surgery",
"BFH32_S150" = "Hospitalization, visceral surgery, \ngastrology, internal medicine, \npeadiatric emergency",
"BFH33_S151" = "Kitchen, laboratory, trauma, \nendoscopy, peadiatrics 2, \ncardiology consultation",
"BFH34_S152" = "Bacteriology lab",
"BFH35_S153" = "Operating room, neurosurgery, \ntraumatology",
"BFH36_S154" = "Operating room, maternity",
"BFH37_S155" = "Mortuary",
"BFH38.A_S156" = "Delivery room",
"BFH38.B_S157" = "Delivery room (technical replicate)",
"BFH39_S158" = "Emergency, resuscitation, \ndental surgery, \nnuclear medicine",
"BFH40_S159" = "Mortuary, emergency, maternity, \nvisceral surgery emergency operating room",
"BFH41_S160" = "Connection point to ONEA WWTP channel",
"BFH42_S161" = "Kossodo river after ONEA WWTP treatment")
# So same to the tax_table
# Extract abundance matrix from the phyloseq object
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 30, cellheight = 15, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 8, fontsize_col = 7,
labels_row = as.expression(newnames), filename = "Yalgado_heat.png")
custom_heat
samples_to_keep <- c("BH01_S76",	"BH02_S77",	"BH03_S78",	"BH04_S79",	"BH05_S80",	"BH06_S81",	"BH07_S82",	"BH09_S83",	"BH10_S84",	"BH11_S85",	"BH58_S113",	"BH59_S114",	"BH60_S115",	"BH61_S116",	"BH62_S117")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
rfc <- plot_bar(rfc0, fill = "Class")
rfc_plot <- rfc +
geom_bar(stat="identity", color = NA, size = 0) +
scale_y_continuous(labels = waiver(), limits=c(0,1.35)) +
scale_fill_manual(values = rfc_cols) +
labs(y = expression(atop(bold("ARG Abundance by Antibiotic Classes"), atop("ARGs / 16S rRNA")))) +
theme_minimal() +
theme(axis.text.x = element_text(size = 14, family = "Times", angle = 90),
axis.text.y = element_text(size = 28, family = "Times", face = "bold", angle = 90),
axis.title.y = element_text(size = 30, family = "Times"),
legend.text = element_text(size = 18, family = "Times"),
legend.title = element_blank(),
legend.key = element_rect(size = 2, color = "white"),
legend.key.size = unit(1, "cm"),
legend.spacing.y = unit(2.2, "char"),
panel.background = element_rect(fill = "#FFFCF3"),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank()) +
facet_grid(~location, scales = "free", space = "free", labeller = label_wrap_gen(width = 15, multi_line = TRUE)) +
theme(strip.text.x= element_text(angle = 90, size = 30, family = "Times", hjust = 0, vjust = 0.75),
strip.background = element_rect(colour = "white"))
## Save plot
ggsave(filename = "Calavi_rfc.png",
width = 16, height = 13, dpi = 300, units = "in", device='png', scale = 1)
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
## Heatmap
# Extract abundance matrix from the phyloseq object
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
# reorder
col_order <- c("BH58_S113", "BH59_S114", "BH60_S115", "BH61_S116", "BH62_S117", "BH01_S76", "BH02_S77", "BH03_S78", "BH04_S79", "BH05_S80", "BH06_S81", "BH07_S82", "BH09_S83", "BH10_S84", "BH11_S85")
heat.df <- heat.df[, col_order]
#rename cols
colnames(heat.df) <- c("BH58_S113" = "Sump next to BH60 (2 m)",
"BH59_S114" = "Sump next to BH60 (10 cm)",
"BH60_S115" = "Emergency, surgery, ophtamology \nand ward sections, (50 cm)",
"BH61_S116" = "Maternity, surgery and \nlaboratory sections (1 m)",
"BH62_S117" = "Maternity, surgery and \nlaboratory sections (10  cm)",
"BH01_S76" = "Neonatology",
"BH02_S77" = "Pediatrics",
"BH03_S78" = "Surgery room",
"BH04_S79" = "Medicine ward, \nempty sump",
"BH05_S80" = "Maternity ward",
"BH06_S81" = "Mortuary ward",
"BH07_S82" = "Laundry room, \nopen pit sump",
"BH09_S83" = "Surgery room for \ndemanding operations, sump",
"BH10_S84" = "Surgery room for \ndemanding operation",
"BH11_S85" = "Well 100 m \naway from the hospital")
# So same to the tax_table
# Extract abundance matrix from the phyloseq object
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 20, cellheight = 10, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 6, fontsize_col = 7,
labels_row = as.expression(newnames), gaps_col = 5,
filename = "Calavi_heat.png")
custom_heat
samples_to_keep <- c("BH13_S86",	"BH14_S87",	"BH27_S92",	"BH29_S93",	"BH30_S94",	"BH31_S95",	"BH32_S96",	"BH33_S97",	"BH34.A_S98",	"BH34.B_S99",	"BH35_S100",	"BH36_S101",	"BH37_S102",	"BH38_S103",	"BH39_S104",	"BH44_S105",	"BH45_S106",	"BH46_S107",	"BH47_S108",	"BH48_S109",	"BH49_S110",	"BH50_S111",	"BH52_S112")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
rfc <- plot_bar(rfc0, fill = "Class")
rfc_plot <- rfc +
geom_bar(stat="identity", color = NA, size = 0) +
scale_y_continuous(labels = waiver(), limits=c(0,1.35)) +
scale_fill_manual(values = rfc_cols) +
labs(y = expression(atop(bold("ARG Abundance by Antibiotic Classes"), atop("ARGs / 16S rRNA")))) +
theme_minimal() +
theme(axis.text.x = element_text(size = 14, family = "Times", angle = 90),
axis.text.y = element_text(size = 28, family = "Times", face = "bold", angle = 90),
axis.title.y = element_text(size = 30, family = "Times"),
legend.text = element_text(size = 18, family = "Times"),
legend.title = element_blank(),
legend.key = element_rect(size = 2, color = "white"),
legend.key.size = unit(1, "cm"),
legend.spacing.y = unit(2.2, "char"),
panel.background = element_rect(fill = "#FFFCF3"),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank()) +
facet_grid(~location, scales = "free", space = "free", labeller = label_wrap_gen(width = 15, multi_line = TRUE)) +
theme(strip.text.x= element_text(angle = 90, size = 30, family = "Times", hjust = 0, vjust = 0.75),
strip.background = element_rect(colour = "white"))
## Save plot
ggsave(filename = "OtherBenin_rfc.png",
width = 16, height = 13, dpi = 300, units = "in", device='png', scale = 1)
# Selected ARGs
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
# Extract abundance matrix from the phyloseq object
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
# reorder
col_order <- c("BH44_S105", "BH45_S106", "BH46_S107", "BH47_S108", "BH48_S109", "BH49_S110", "BH50_S111", "BH52_S112", "BH13_S86", "BH14_S87", "BH27_S92", "BH29_S93", "BH30_S94", "BH31_S95", "BH32_S96", "BH33_S97", "BH34.A_S98", "BH34.B_S99", "BH35_S100", "BH36_S101", "BH37_S102", "BH38_S103", "BH39_S104")
heat.df <- heat.df[, col_order]
# rename cols
colnames(heat.df) <- c("BH44_S105" = "Central ST (10 cm)",
"BH45_S106" = "Central ST (1 m) ",
"BH46_S107" = "Pediatric clinic (20 cm)",
"BH47_S108" = "Hospitalization ward, \nvaccination room",
"BH48_S109" = "Water pool surrounding \nthe surgery room",
"BH49_S110" = "Maternity clinic",
"BH50_S111" = "Peripheral ST collecting \nmainly toilet waters",
"BH52_S112" = "Tank for washing hands",
"BH13_S86" = "Street gutter 100 m \naway from the hospital, water",
"BH14_S87" = "Street gutter 100 m \naway from the hospital, soil",
"BH27_S92" = "Central ST for ICU, \nlaundry room, laboratory unit \nand maternal & child health unit",
"BH29_S93" = "Surgery unit, open tank",
"BH30_S94" = "Surgery unit 1st peripheral ST",
"BH31_S95" = "Surgery unit 2nd pheripheral ST",
"BH32_S96" = "Moist soil between \nBH31 & BH34",
"BH33_S97" = "Surgery unit 3rd \nperipheral ST",
"BH34.A_S98" = "Surgery unit central ST, (10cm)",
"BH34.B_S99" = "Surgery unit central ST, (10cm) \n(technical replicate)",
"BH35_S100" = "Surgery for minor operations",
"BH36_S101" = "Maternity ward",
"BH37_S102" = "Central ST for BH35 \nand BH36 (surface layer)",
"BH38_S103" = "Central ST for BH35 \nand BH36 (1,4 cm)",
"BH39_S104" = "ST collecting all laboratory \nwaters from the hospital")
# So same to the tax_table
# Extract abundance matrix from the phyloseq object
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 15, cellheight = 10, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 7, fontsize_col = 5,
labels_row = as.expression(newnames), gaps_col = 8,
filename = "OtherBenin_heat.png")
custom_heat
knitr::opts_chunk$set(echo = TRUE)
library(phyloseq)
library(dplyr)
library(viridis)
library(stringr)
library(vegan)
library(RColorBrewer)
library(BiocManager)
BiocManager::install("microbiome")
library(microbiome)
library(microbiomeutilities)
library(ggplot2)
library(knitr)
library(ggpubr)
library(pheatmap)
library(MASS)
library(multcomp)
library(gplots)
library(readr)
library(grid)
library(cowplot)
library(gridExtra)
samples_to_keep <- c("BFH1_S123",	"BFH4_S124",	"BFH16_S134",	"BFH17_S135",	"BFH18_S136",	"BFH19_S137",	"BFH20_S138",	"BFH21_S139",	"BFH22_S140",	"BFH23_S141",	"BFH25_S143",	"BFH26_S144",	"BFH27_S145",	"BFH28_S146")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
col_order <- c("BFH16_S134", "BFH17_S135", "BFH18_S136", "BFH19_S137", "BFH20_S138", "BFH21_S139", "BFH22_S140", "BFH23_S141", "BFH25_S143", "BFH26_S144", "BFH27_S145", "BFH28_S146", "BFH1_S123", "BFH4_S124")
heat.df <- heat.df[, col_order]
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 20, cellheight = 10, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 5, fontsize_col = 6,
labels_row = as.expression(newnames), gaps_col = 12,
filename = "OtherBF_heat.png")
custom_heat
custom_heat
samples_to_keep <- c("BFH29_S147",	"BFH30_S148",	"BFH31_S149",	"BFH32_S150",	"BFH33_S151",	"BFH34_S152",	"BFH35_S153",	"BFH36_S154",	"BFH37_S155",	"BFH38.A_S156",	"BFH38.B_S157",	"BFH39_S158",	"BFH40_S159",	"BFH41_S160",	"BFH42_S161")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
# reorder
col_order <- c("BFH29_S147", "BFH30_S148", "BFH32_S150", "BFH33_S151", "BFH34_S152", "BFH35_S153", "BFH36_S154", "BFH37_S155", "BFH38.A_S156", "BFH38.B_S157", "BFH39_S158", "BFH40_S159", "BFH40_S159", "BFH41_S160", "BFH42_S161")
heat.df <- heat.df[, col_order]
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 30, cellheight = 15, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 8, fontsize_col = 7,
labels_row = as.expression(newnames), filename = "Yalgado_heat.png")
custom_heat
custom_heat
View(heat.df)
col_order <- c("BFH29_S147", "BFH30_S148", "BFH31_S149", "BFH32_S150", "BFH33_S151", "BFH34_S152", "BFH35_S153", "BFH36_S154", "BFH37_S155", "BFH38.A_S156", "BFH38.B_S157", "BFH39_S158", "BFH40_S159", "BFH40_S159", "BFH41_S160", "BFH42_S161")
heat.df <- heat.df[, col_order]
samples_to_keep <- c("BFH29_S147",	"BFH30_S148",	"BFH31_S149",	"BFH32_S150",	"BFH33_S151",	"BFH34_S152",	"BFH35_S153",	"BFH36_S154",	"BFH37_S155",	"BFH38.A_S156",	"BFH38.B_S157",	"BFH39_S158",	"BFH40_S159",	"BFH41_S160",	"BFH42_S161")
rfc0 <- prune_samples(samples_to_keep, resfinder_PHY_heat)
resfinder_PHY_gene <- tax_glom(rfc0, taxrank = "Gene")
rf_select <- subset_taxa(resfinder_PHY_gene,
Gene == "blaCMY-2_1" | Gene == "blaKPC-3_1" | Gene == "blaOXA-48_1" |
Gene == "blaOXA-58_1" | Gene == "blaOXA-181_1" | Gene == "blaVIM-5_1" |
Gene == "blaNDM-1_1" | Gene == "blaGES-5_1" | Gene == "blaCTX-M-15_1" |
Gene == "mcr-1.1_1" | Gene == "mcr-3.15_1" |
Gene == "mcr-3.1_1" | Gene == "blaNDM-5_1" | Gene == "blaMOX-6_1" |
Gene == "blaKPC-2_1" | Gene == "blaOXA-10_1" | Gene == "blaACT-4_2")
# Extract abundance matrix from the phyloseq object
heat_OTU = as(otu_table(rf_select), "matrix")
# Coerce to data.frame
heat.df = as.data.frame(heat_OTU)
# Change otu names from sp* into gene names
colnames(heat.df)
# reorder
col_order <- c("BFH29_S147", "BFH30_S148", "BFH31_S149", "BFH32_S150", "BFH33_S151", "BFH34_S152", "BFH35_S153", "BFH36_S154", "BFH37_S155", "BFH38.A_S156", "BFH38.B_S157", "BFH39_S158", "BFH40_S159", "BFH40_S159", "BFH41_S160", "BFH42_S161")
heat.df <- heat.df[, col_order]
# rename cols
colnames(heat.df) <- c("BFH29_S147" = "Urology, infectious diseases, pneumology",
"BFH30_S148" = "Urology, infectious diseases, \npneumology, daily hospital, \ndialysis, blood bank",
"BFH31_S149" = "Anatomy pathology laboratory, \nophtalmology, laboratory of \nhematology-biochemestry, surgery",
"BFH32_S150" = "Hospitalization, visceral surgery, \ngastrology, internal medicine, \npeadiatric emergency",
"BFH33_S151" = "Kitchen, laboratory, trauma, \nendoscopy, peadiatrics 2, \ncardiology consultation",
"BFH34_S152" = "Bacteriology lab",
"BFH35_S153" = "Operating room, neurosurgery, \ntraumatology",
"BFH36_S154" = "Operating room, maternity",
"BFH37_S155" = "Mortuary",
"BFH38.A_S156" = "Delivery room",
"BFH38.B_S157" = "Delivery room (technical replicate)",
"BFH39_S158" = "Emergency, resuscitation, \ndental surgery, \nnuclear medicine",
"BFH40_S159" = "Mortuary, emergency, maternity, \nvisceral surgery emergency operating room",
"BFH41_S160" = "Connection point to ONEA WWTP channel",
"BFH42_S161" = "Kossodo river after ONEA WWTP treatment")
# So same to the tax_table
# Extract abundance matrix from the phyloseq object
heat_tax = as(tax_table(rf_select), "matrix")
# Save to get it back without the current first header row
write.table(heat_tax, "~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=T, sep = "\t", col.names = F)
heat_tax <- read.delim("~/Documents/Metagenomes_AMRIWA/R/AMRIWA/RFiles/heat_tax", row.names=1, header = F)
# as dataframe
heat_tax.df = as.data.frame(heat_tax)
# Swap colnames
rownames(heat.df) <- heat_tax.df$V3
## Plot log: palette
newnames <- lapply(
rownames(heat.df),
function(x) bquote(italic(.(x))))
custom_heat <- pheatmap(log10(heat.df), cluster_rows = F, cluster_cols = F,
cellwidth = 30, cellheight = 15, border_color = "white", fontsize=15,
colorRampPalette(brewer.pal(9, "Blues"))(100), main = "ARGs/16S rRNA, log10",
angle_col = 90, legend = TRUE, fontsize_row = 8, fontsize_col = 7,
labels_row = as.expression(newnames), filename = "Yalgado_heat.png")
custom_heat
custom_heat
